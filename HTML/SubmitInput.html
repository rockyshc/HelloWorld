<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SubmitInput</title>
</head>
<body>
<label>String:</label>
<input id="input" type="text" value=""/>
<label><button onclick="check()">Click</button></label>

<script language="javascript">
    //If not positiveInteger return false
    function isPositiveInteger(str) {
        //return /^\+?(0|[1-9]\d*)$/.test(str);
        //TODO need to check it
        var n = Math.floor(Number(str));
        return String(n) === str && n > 0;
    }

    function checkInput(input){
        if (isNaN(input)){
            document.write("Not a number. Please input a positive integer. ");
            return false;
        }else if(input === null){
            document.write("Your input is null");
            return false;
        }else if(!isPositiveInteger(input)){
            document.write("It's a number. But please input a positive integer. ");
            return false;
        }else if(isPositiveInteger(input)){
            return true;
        }
        return false;
    }

    //Normal Recursive function
    //43 need  7742 ms  and 44 need 12557 ms 46 need 34146 ms
    function fibonacciR(n) {
        if (n==1 || n == 2){
            return 1;
        }
        return fibonacciR(n-1) + fibonacciR(n-2);
    }

    //Loop function
    function fibonacciLoop(n){
        var n1 = 1;
        var n2 = 1;
        var n3 = 0;
        if (n==1 || n == 2){
            return 1;
        }
        for(var i = 2;i <= n;i++){
            n3 = n1 + n2;
            n1 = n2;
            n2 = n3;
        }
        return n1
    }

    //Enhance 1
    //1500 need 1ms and result is infinity
    let fibonacciRE = (function() {
        let memory = []
        return function(n) {
            if(memory[n] !== undefined) {
                return memory[n]
            }
            return memory[n] = (n === 0 || n === 1) ? n : fibonacciRE(n-1) + fibonacciRE(n-2)
        }
    })()

    function getFibonacciLoop(number) {
        if (checkInput(number)){
            var start = new Date().getTime();
            var result = fibonacciLoop(number);
            var end = new Date().getTime();
            return ("Use loop way: Your input is " + number + "\n" +
                "And fibonacci number is " + result + "\n" +
                "Need " + (end - start) + " ms!");
        }
    }

    function getFibonacciGood(number) {
        if (checkInput(number)){
            var start = new Date().getTime();
            var result = fibonacciRE(number);
            var end = new Date().getTime();
            return ("Use recursion enhance way: Your input is " + number +"\n" +
                "And fibonacci number is " + result + "\n" +
                "Need " + (end - start) + " ms!");
        }
    }

    function getFibonacciBad(number) {
        if (checkInput(number) && number < 46 ){
            var start = new Date().getTime();
            var result = fibonacciR(number);
            var end = new Date().getTime();
            return ("Use normal recursion way: Your input is " + number + "\n" +
                "And fibonacci number is " + result + "\n" +
                "Need " + (end - start) + " ms!");
        }else{
            return ("If number more then 45 the performance will be very bed")
        }
    }
    function getId(id) {
        return document.getElementById(id);
    }

    function check()
    {
        document.write(getFibonacciLoop(getId("input").value) + getFibonacciGood(getId("input").value));
    }


</script>
</body>
</html>